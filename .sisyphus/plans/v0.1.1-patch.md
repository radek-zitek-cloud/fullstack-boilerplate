# Implementation Plan: v0.1.1 Patch

## TL;DR

**Scope**: User profile enrichment + Theme system (light/dark + color variants)
**Effort**: Medium (14 tasks)
**Parallel Waves**: 3
**Breaking Changes**: None (database migration required)

---

## Feature 1: User Profile Enrichment

### What We'll Implement
- Add `first_name`, `last_name`, `note` fields to User model
- Profile update endpoint (PATCH /users/me)
- Password change endpoint (POST /auth/change-password)
- Profile page UI with edit functionality
- Password change UI
- Note: **Refresh token already implemented!** ✅
- Note: **Forgotten password skipped** for v0.1.1 (requires email flow)

### Backend Tasks

**Task 1.1**: Update User model
- Add first_name: Optional[str]
- Add last_name: Optional[str]  
- Add note: Optional[str] (text field)
- Create Alembic migration

**Task 1.2**: Update User schemas
- Add fields to UserResponse
- Add ProfileUpdate schema (first_name, last_name, note)
- Add PasswordChange schema (current_password, new_password)

**Task 1.3**: Create profile endpoints
- GET /users/me - Enhanced with new fields
- PATCH /users/me - Update profile
- POST /auth/change-password - Change password

**Task 1.4**: Update registration
- Accept optional first_name, last_name on register

### Frontend Tasks

**Task 1.5**: Update AuthContext
- Extend User interface with new fields
- Add updateProfile() method
- Add changePassword() method

**Task 1.6**: Create ProfilePage
- Display user info (email, names, note)
- Edit form for names and note
- Password change section

**Task 1.7**: Update navigation
- Add Profile link to Layout
- Add route for /profile

---

## Feature 2: Theme System

### What We'll Implement
- Light/Dark mode toggle
- System preference detection
- localStorage persistence
- 3 color variants: slate (default), blue, emerald
- Theme toggle in header dropdown
- CSS variable updates for color variants

### Design Decisions

**Theme Storage**: localStorage (persists across sessions)  
**Default**: System preference (falls back to light)  
**Color Variants**: Slate (default), Blue, Emerald  
**Toggle Location**: User dropdown in header

### Frontend Tasks

**Task 2.1**: Create ThemeContext
- Store theme mode (light/dark/system)
- Store color variant (slate/blue/emerald)
- localStorage persistence
- System preference detection
- Toggle methods

**Task 2.2**: Update CSS variables
- Create theme variants in index.css
- Slate (current), Blue, Emerald color schemes
- Dynamic CSS variable switching

**Task 2.3**: Create ThemeProvider
- Wrap app with theme provider
- Apply theme class to document
- Handle system preference changes

**Task 2.4**: Create SettingsPage with Appearance section
- Theme mode selector (Light/Dark/System)
- Color variant selector (Slate/Blue/Emerald)
- Preview of selected theme
- Save to localStorage

**Task 2.5**: Update Layout
- Add Settings link to user dropdown
- Apply theme classes to document

**Task 2.6**: Create quick theme toggle (optional header)
- Simple light/dark toggle in header (optional)

---

## Execution Waves

```
Wave 1: Backend Foundation
├── Task 1.1: Update User model + migration
├── Task 1.2: Update User schemas
└── Task 1.3: Profile endpoints

Wave 2: Frontend Features (parallel with Wave 1)
├── Task 1.5: Update AuthContext
├── Task 2.1: Create ThemeContext
└── Task 2.2: Update CSS variables

Wave 3: UI Components
├── Task 1.4: Update registration
├── Task 1.6: ProfilePage
├── Task 1.7: Update navigation
├── Task 2.3: ThemeProvider
├── Task 2.4: ThemeToggle
└── Task 2.5: Update Layout

Wave 4: Final Integration
├── Run migrations
├── Test all features
├── Update README
└── Version bump to v0.1.1
```

---

## API Changes

### New Endpoints
```
PATCH /api/v1/users/me          # Update profile
POST /api/v1/auth/change-password  # Change password
```

### Modified Endpoints
```
GET /api/v1/users/me            # Returns first_name, last_name, note
POST /api/v1/auth/register      # Accepts optional first_name, last_name
```

---

## Database Migration

```sql
-- Add columns to users table
ALTER TABLE users ADD COLUMN first_name VARCHAR(255);
ALTER TABLE users ADD COLUMN last_name VARCHAR(255);
ALTER TABLE users ADD COLUMN note TEXT;
```

---

## Testing Checklist

- [ ] User can update first/last name
- [ ] User can update note
- [ ] User can change password
- [ ] Password change validates current password
- [ ] Profile displays all fields
- [ ] Theme toggles between light/dark
- [ ] Theme persists in localStorage
- [ ] Color variants switch correctly
- [ ] System preference detection works
- [ ] All existing features still work

---

## Definition of Done

- [ ] All 14 tasks complete
- [ ] Database migrated
- [ ] Tests passing
- [ ] README updated with new features
- [ ] Git tag v0.1.1 created
- [ ] All acceptance criteria met
